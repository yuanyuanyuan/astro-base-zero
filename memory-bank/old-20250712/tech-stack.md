# Astro项目快速发布平台 - 技术栈决策文档

**版本:** 1.1
**日期:** 2025-01-11
**决策者:** Vibe-coding 架构师
**核心原则:** 尽可能最简单且最健壮的技术栈

---

## 1. 三层滤网分析

### 1.1 功能性需求分析（它需要"做什么"？）
- **CLI工具开发**：需要命令行交互、文件操作、模板生成
- **配置管理**：YAML解析、虚拟模块系统、热更新
- **组件生态**：可复用UI组件、主题系统、插槽机制
- **项目管理**：Web界面、数据持久化、跨项目分析
- **模板系统**：模板解析、变量替换、文件生成

### 1.2 非功能性需求分析（它需要"做得多好"？）
- **性能要求**：项目创建 < 15秒
- **质量要求**：类型安全100%覆盖，Lighthouse > 95分
- **规模预期**：首月1000+项目，10+社区模板
- **开发效率**：30分钟新用户上手，极致DX体验
- **可维护性**：模块化架构，清晰的关注点分离

### 1.3 未来愿景分析（它"将要去向何方"？）
- **V2扩展**：云端构建服务、团队协作、付费模板
- **生态建设**：插件系统、第三方集成、社区市场
- **智能化**：~~更强大的AI顾问、自动化优化建议~~ (V2规划)
- **平台化**：从工具演进为完整的项目管理平台

---

## 2. 技术栈决策

### 2.1 核心运行时
```yaml
Node.js: v22.14.0 (LTS)
选型理由: 
  - 原生支持ES模块，无需转译
  - 内置测试运行器，减少依赖
  - 性能优异，生态成熟
  - 与Astro完美兼容
```

### 2.2 包管理器
```yaml
pnpm: v9.1.1
选型理由:
  - Monorepo原生支持，符合项目结构
  - 硬链接机制，节省磁盘空间
  - 严格的依赖管理，避免幽灵依赖
  - 比npm/yarn更快的安装速度
```

### 2.3 基础框架层

#### CLI工具栈
```yaml
Commander.js: v12.0.0  # CLI框架
选型理由: 简单、稳定、文档完善，Astro官方也在使用

Inquirer.js: v9.2.14  # 交互式提示
选型理由: 最成熟的交互库，用户体验优秀

Chalk: v5.3.0  # 终端美化
选型理由: 零依赖，性能极佳

Ora: v8.0.1  # 加载动画
选型理由: 轻量级，API简洁
```

#### 前端框架（继承AstroWind）
```yaml
Astro: v5.0.0  # 核心框架
选型理由: 
  - Islands架构，默认零JS
  - 完美的SEO和性能
  - 与AstroWind天然契合

Tailwind CSS: v3.4.1  # 样式框架
选型理由:
  - AstroWind标准选择
  - Utility-first理念
  - 优秀的主题系统

TypeScript: v5.3.3  # 类型系统
选型理由:
  - 端到端类型安全
  - 最佳的IDE支持
  - 项目质量保证
```

### 2.4 配置与模板层

```yaml
YAML: v2.3.4  # YAML解析器
选型理由: 兼容AstroWind的config.yaml格式

Handlebars: v4.7.8  # 模板引擎
选型理由: 
  - 逻辑简单，学习成本低
  - 支持部分模板和助手函数
  - 成熟稳定，社区活跃

Zod: v3.22.4  # Schema验证
选型理由:
  - TypeScript优先设计
  - 运行时验证
  - 与Astro Content Collections完美集成
```

### 2.5 数据存储层

```yaml
# V1阶段：静态优先 + 本地存储策略
lowdb: v7.0.1  # 轻量级JSON数据库
选型理由:
  - CLI工具的项目元数据存储
  - 零配置，开箱即用
  - Dashboard通过静态方式读取展示

# 静态数据处理
browser-only: 静态页面通过JavaScript读取本地数据
选型理由:
  - 兼容GitHub Pages静态部署
  - 无服务器端依赖
  - 数据处理在客户端完成

# V2预留接口
# PostgreSQL + Prisma (云端协作功能)
```

### 2.6 开发工具链

```yaml
Vite: v5.0.12  # 构建工具
选型理由: Astro默认集成，极快的HMR

Vitest: v1.2.2  # 测试框架
选型理由: 
  - 与Vite共享配置
  - 原生ESM支持
  - 优秀的IDE集成

ESLint: v8.56.0  # 代码检查
Prettier: v3.2.4  # 代码格式化
选型理由: 行业标准，确保代码质量

Turbo: v1.12.0  # Monorepo构建
选型理由:
  - 增量构建，极致性能
  - 智能缓存机制
  - Vercel官方维护
```

### 2.7 部署与运维

```yaml
# 静态站点部署
GitHub Actions: latest  # CI/CD
选型理由: 
  - 与GitHub Pages深度集成
  - 免费额度充足
  - 配置简单

# 监控（可选）
Sentry: v7.100.0  # 错误追踪
选型理由: 行业标准，免费额度够用
```

---

## 3. 架构决策与权衡

### 3.1 关键决策

1. **不使用Next.js/Remix等全栈框架**
   - 理由：项目核心是静态站点生成，不需要SSR复杂性
   - Astro的Islands架构更符合性能目标

2. **V1版本不引入任何AI集成**
   - 理由：遵循Vibe-coding原则，聚焦核心功能，降低初期复杂度和维护成本。
   - 将AI作为V2的增强功能进行规划。

3. **本地存储优先**
   - 理由：V1专注核心功能，避免后端复杂性
   - 便于用户快速上手
   - 为V2云端化预留清晰升级路径

4. **Monorepo架构**
   - 理由：多包协同开发，代码复用
   - 统一的版本管理和发布流程
   - 更好的类型安全保证

5. **ADR-004: 静态优先架构决策** 🆕
   - **背景**: 原计划包含服务器端项目管理功能
   - **决策**: 完全转向静态部署模式，Dashboard作为CLI指导中心
   - **理由**: 
     - GitHub Pages部署兼容性要求
     - 降低架构复杂度和维护成本
     - 本地CLI工具提供更强大的项目管理能力
   - **影响**: 
     - 移除服务器端API依赖
     - 项目操作通过本地CLI完成
     - Dashboard专注于指导和展示功能

### 3.2 简洁性 vs 扩展性平衡

- **立即可用**：选择成熟、文档完善的技术
- **增量复杂**：核心保持简单，复杂功能按需引入
- **清晰边界**：每个技术职责单一，便于替换
- **标准优先**：优先选择行业标准，降低学习成本

---

## 4. 风险评估与缓解

### 4.1 技术风险
- **风险**：Astro 5.0相对较新
- **缓解**：核心API稳定，持续关注更新日志

### 4.2 性能风险
- **风险**：Monorepo 在 Windows 上的性能可能略有损耗
- **缓解**：使用 Turbo 进行构建缓存，优化脚本执行

### 4.3 静态架构风险 🆕
- **风险**：客户端数据处理可能受用户环境限制
- **缓解**：
  - 提供优雅降级机制
  - 核心功能通过CLI保证可用性
  - 数据结构简单，减少处理复杂度

### 4.4 扩展风险
- **风险**：本地存储限制未来云端扩展
- **缓解**：设计清晰的数据访问层，便于V2迁移

---

## 5. 快速启动指南

```bash
# 1. 环境准备
# 确保 Node.js v22.14.0 和 pnpm v9.1.1 已安装
# nvm use 22.14.0
# npm install -g pnpm@9.1.1

# 2. 项目初始化
git clone <repository>
cd astro-project-launcher
pnpm install

# 3. 开发模式
pnpm dev

# 4. 构建
pnpm build

# 5. 测试
pnpm test
```

---

## 6. 结论

这份技术栈遵循"尽可能最简单且最健壮"的核心原则：
- **简单**：每个选择都是该领域的"标准答案"
- **健壮**：优先选择成熟、稳定、维护活跃的技术
- **聚焦**：技术服务于产品，而非炫技
- **务实**：立足当下，适度考虑未来

通过这个技术栈，我们能够在保证工程质量的同时，让团队将注意力集中在产品价值的创造上，而非技术复杂性的管理上。 